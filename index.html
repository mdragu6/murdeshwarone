<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MurdeshwarOne</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{margin:0;font-family:Arial;background:#F1F5F9}
header{background:#0A4A78;color:#fff;padding:1rem;display:flex;justify-content:space-between}
.menu{display:flex;gap:6px;padding:10px;background:#fff;overflow:auto}
.menu button{border:none;padding:8px 12px;border-radius:20px;cursor:pointer}
.section{display:none;padding:1rem}
.section.active{display:block}
.card{background:#fff;padding:1rem;border-radius:12px;margin-bottom:1rem}
.star{cursor:pointer;color:#cbd5e1}
.star:hover{color:#f59e0b}
</style>
</head>

<body>

<header>
<h2>MurdeshwarOne</h2>
</header>

<div class="menu">
<button onclick="show('workers',this)">Workers</button>
<button onclick="show('rooms',this)">Rooms</button>
<button onclick="show('food',this)">Food</button>
<button onclick="show('transport',this)">Transport</button>
<button onclick="show('services',this)">Services</button>
<button onclick="show('places',this)">Places</button>
<button onclick="show('map',this)">Map</button>
</div>

<div id="workers" class="section active"></div>
<div id="rooms" class="section"></div>
<div id="food" class="section"></div>
<div id="transport" class="section"></div>
<div id="services" class="section"></div>
<div id="places" class="section"></div>
<div id="map" class="section"><div id="mapView" style="height:400px"></div></div>

<script>
const SHEET_ID="1NfFwlfVukVQoujYuz7GkbK92FMYa1nQVYLOvjgr8qMw";
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwXc3b27Qy3C5CVJm52RJlGrJIVkGRW86qMCUnMTTbNuhj9wdiLzMNGW2nRw9dlNYrP/exec";

function track(event,name,category){
fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify({event,name,category})});
}

function show(id,btn){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

/* CARD */
function card(x,cat){
return `
<div class="card" onclick="track('view','${x.name}',cat)">
<b>${x.name}</b><br>
⭐ ${x.rating||0} (${x.reviews||0})
<div>${x.details||""}</div>
<a href="tel:${x.phone}" onclick="track('call','${x.name}',cat)">Call</a>
<a href="https://wa.me/91${x.phone}" target="_blank"
onclick="track('whatsapp','${x.name}',cat)">WhatsApp</a>
<div>
${[1,2,3,4,5].map(s=>`
<span class="star"
onclick="rate('${x.name}','${cat}',${s});event.stopPropagation();">★</span>
`).join("")}
</div>
</div>`;
}

function load(sheet,id){
fetch(`https://opensheet.elk.sh/${SHEET_ID}/${sheet}`)
.then(r=>r.json())
.then(d=>{
const approved=d.filter(x=>x.approval==="approved");
document.getElementById(id).innerHTML=
"<h2>"+sheet+"</h2>"+approved.map(x=>card(x,sheet)).join("");
});
}

["workers","rooms","food","transport","services","places"]
.forEach(s=>load(s,s));

/* MAP */
const map=L.map('mapView').setView([14.0944,74.4845],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

fetch(`https://opensheet.elk.sh/${SHEET_ID}/places`)
.then(r=>r.json())
.then(d=>{
d.filter(p=>p.approval==="approved")
.forEach(p=>{
L.marker([p.lat,p.lng]).addTo(map).bindPopup(p.name);
});
});

/* RATE */
function rate(name,category,stars){
const key=category+"_"+name+"_rated";
if(localStorage.getItem(key)) return alert("Already rated");

fetch(SCRIPT_URL,{
method:"POST",
body:JSON.stringify({name,category,rating:stars})
});

localStorage.setItem(key,"true");
alert("Thanks!");
}
</script>

</body>
</html>
